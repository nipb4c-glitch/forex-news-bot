name: Forex News Bot

on:
  schedule:
    - cron: '*/10 * * * *'  # Ù‡Ø± Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡
  workflow_dispatch:

jobs:
  check-news:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4 pytz
        
    - name: Create and run Forex bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        CHAT_ID: ${{ secrets.CHAT_ID }}
      run: |
        # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø§ÛŒØªÙˆÙ†
        cat > bot.py << 'EOF'
import requests
import os
from datetime import datetime, timedelta
from bs4 import BeautifulSoup

BOT_TOKEN = os.environ['BOT_TOKEN']
CHAT_ID = os.environ['CHAT_ID']

def send_message(text):
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
    data = {
        "chat_id": CHAT_ID,
        "text": text,
        "parse_mode": "HTML"
    }
    try:
        response = requests.post(url, json=data, timeout=10)
        print("âœ… Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯")
        return True
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø§: {e}")
        return False

def get_news():
    try:
        headers = {'User-Agent': 'Mozilla/5.0'}
        response = requests.get("https://www.forexfactory.com/", headers=headers, timeout=10)
        soup = BeautifulSoup(response.content, 'html.parser')
        
        # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²
        events = []
        rows = soup.find_all('tr', class_='calendar__row')
        
        for row in rows:
            try:
                time_cell = row.find('td', class_='calendar__time')
                if not time_cell:
                    continue
                
                time_text = time_cell.get_text(strip=True)
                if not time_text or time_text in ['All Day', 'Tentative', 'Later']:
                    continue
                
                currency_cell = row.find('td', class_='calendar__currency')
                event_cell = row.find('td', class_='calendar__event')
                
                if currency_cell and event_cell:
                    currency = currency_cell.get_text(strip=True)
                    event_name = event_cell.get_text(strip=True)
                    
                    # Ø§Ø®Ø¨Ø§Ø± Ù…Ù‡Ù…
                    important = ['NFP', 'CPI', 'Interest Rate', 'GDP', 'Employment', 'FOMC']
                    if any(word in event_name for word in important):
                        events.append(f"ðŸ’° {currency} - {event_name} â° {time_text}")
                        
            except:
                continue
        
        return events
        
    except Exception as e:
        print(f"Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø®Ø¨Ø§Ø±: {e}")
        return []

# Ø§Ø¬Ø±Ø§ÛŒ Ø§ØµÙ„ÛŒ
print("ðŸ¤– Ø´Ø±ÙˆØ¹ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø®Ø¨Ø§Ø±...")
news_events = get_news()

if news_events:
    message = "ðŸ“Š Ø§Ø®Ø¨Ø§Ø± Ù…Ù‡Ù… Ø§Ù…Ø±ÙˆØ²:\n\n" + "\n".join(news_events[:5])  # Ø­Ø¯Ø§Ú©Ø«Ø± Ûµ Ø®Ø¨Ø±
    send_message(message)
    print("ðŸ“¨ Ø§Ø®Ø¨Ø§Ø± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯")
else:
    send_message("ðŸ“Š Ø§Ù…Ø±ÙˆØ² Ø®Ø¨Ø± Ù…Ù‡Ù…ÛŒ Ù†ÛŒØ³Øª")
    print("âœ… Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯")
EOF

        # Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª
        python bot.py
